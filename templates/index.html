<!DOCTYPE html>
<html>

<head>
    <title>英雄联盟攻略小助手</title>
    <link rel="icon" href="../static/images/favicon.ico">
    <link rel="stylesheet" href="../static/css/index.css">
</head>

<body>
    <div class="chat_commento">
        <!-- top -->
        <div class="chat_top">
            <img src="../static/images/img1.jpg" width="25" height="25">是兄弟就来砍我
        </div>
        <!-- line -->
        <div class="line"></div>
        <!-- middle -->
        <div class="chat_middle" id="chat_middle_item">
            
        </div>
        <!-- line -->
        <div class="line"></div>
        <!-- foot -->
        <div class="chat_foot">
            <!-- context -->
            <textarea class="chat_context" id="chat_context_item" cols="30" rows="10" placeholder="请输入"></textarea>
            <div class="chat_commit" id="button">发送</div>
        </div>
    </div>
    <script>
        // 成功发送
        var send_message = document.getElementById("chat_middle_item");
        var domBtm = document.getElementById("button");
        // 发送内容
        var message = document.getElementById("chat_context_item");
        domBtm.addEventListener("click", function () {
            var str = message.value;
            var date = new Date();
            var hour = date.getHours();
            var mm = date.getMinutes();
            var time = hour + ':' + mm;
            var ans = '<div class="chat_right_item_1">用户</div>' +
                '<div class="chat_right_item_2">' +
                '<div class="chat_right_time">' + time + '</div>' +
                '<div class="chat_right_content">' + str + '</div>'
                + '</div>';
            var oLi = document.createElement("div");
            oLi.setAttribute("class", "chat_right");
            oLi.setAttribute("id","user");
            oLi.innerHTML = ans;
            send_message.append(oLi);

        });
        //回复消息
        document.addEventListener('DOMNodeInserted', function (event) {
            if(event.target.id=='user'){
            var question = message.value;
            message.value = "";
            var date = new Date();
            var hour = date.getHours();
            var mm = date.getMinutes();
            var time = hour + ':' + mm;
            fetch('/reply', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    question: question
                })
            })
                .then(res => res.json())
                .then(data => {
                    const reply = data.reply;

                    // 添加回复到页面
                    var ans = '<div class="chat_left_item_1 ">人工小智障</div>' +
                        '<div class="chat_left_item_2">' +
                        '<div class="chat_left_time">' + time + '</div>' +
                        '<div class="chat_left_content">' + reply + '</div>' +
                        '</div>';
                    var oLi = document.createElement("div");
                    oLi.setAttribute("class", "chat_left");
                    oLi.innerHTML = ans;
                    send_message.append(oLi);

                });
            }
        });
    </script>
</body>

</html>